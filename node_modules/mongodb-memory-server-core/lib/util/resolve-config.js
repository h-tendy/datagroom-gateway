"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.envToBool = exports.reInitializePackageJson = exports.findPackageJson = exports.setDefaultValue = void 0;
var camelcase_1 = __importDefault(require("camelcase"));
var find_package_json_1 = __importDefault(require("find-package-json"));
var debug_1 = __importDefault(require("debug"));
var log = debug_1.default('MongoMS:ResolveConfig');
var ENV_CONFIG_PREFIX = 'MONGOMS_';
var defaultValues = new Map();
/**
 * Set an Default value for an specific key
 * Mostly only used internally (for the "global-x.x" packages)
 * @param key The Key the default value should be assigned to
 * @param value The Value what the default should be
 */
function setDefaultValue(key, value) {
    defaultValues.set(key, value);
}
exports.setDefaultValue = setDefaultValue;
var packageJsonConfig = {};
/**
 * Find the nearest package.json for the provided directory
 * @param directory Set an custom directory to search the config in (default: process.cwd())
 */
function findPackageJson(directory) {
    var _a, _b, _c;
    var finderIterator = find_package_json_1.default(directory || process.cwd()).next();
    log("Using package.json at \"" + finderIterator.filename + "\"");
    packageJsonConfig = (_c = (_b = (_a = finderIterator.value) === null || _a === void 0 ? void 0 : _a.config) === null || _b === void 0 ? void 0 : _b.mongodbMemoryServer) !== null && _c !== void 0 ? _c : {};
}
exports.findPackageJson = findPackageJson;
exports.reInitializePackageJson = findPackageJson; // TODO: remove this line on next minor version
findPackageJson();
/**
 * Resolve "variableName" with a prefix of "ENV_CONFIG_PREFIX"
 * @param variableName The variable to use
 */
function resolveConfig(variableName) {
    var _a, _b;
    return ((_b = (_a = process.env["" + ENV_CONFIG_PREFIX + variableName]) !== null && _a !== void 0 ? _a : packageJsonConfig === null || packageJsonConfig === void 0 ? void 0 : packageJsonConfig[camelcase_1.default(variableName)]) !== null && _b !== void 0 ? _b : defaultValues.get(variableName));
}
exports.default = resolveConfig;
/**
 * Convert "1, on, yes, true" to true (otherwise false)
 * @param env The String / Environment Variable to check
 */
function envToBool(env) {
    if (env === void 0) { env = ''; }
    return ['1', 'on', 'yes', 'true'].indexOf(env.toLowerCase()) !== -1;
}
exports.envToBool = envToBool;
// enable debug if "MONGOMS_DEBUG" is true
if (envToBool(resolveConfig('DEBUG'))) {
    debug_1.default.enable('MongoMS:*');
}
//# sourceMappingURL=resolve-config.js.map